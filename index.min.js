'use strict';var kraken=require('kraken-js'),auth=require('./lib/auth'),db=require('./lib/database'),passport=require('passport'),express=require('express'),flash=require('connect-flash'),lusca=require('lusca'),app={};app.configure=function configure(nconf,next){passport.use(auth.localStrategy());passport.serializeUser(function(user,done){done(null,user.id);});passport.deserializeUser(function(id,done){User.findOne({_id:id},function(err,user){done(null,user);});});db.config(nconf.get('databaseConfig'));next(null);};app.requestStart=function requestStart(server){};app.requestBeforeRoute=function requestBeforeRoute(server){server.use(express.methodOverride());server.use(express.bodyParser());server.use(passport.initialize());server.use(passport.session());server.use(flash());server.use(auth.injectUser);};app.requestAfterRoute=function requestAfterRoute(server){};if(require.main===module){kraken.create(app).listen(function(err){if(err){console.error(err.stack);}});}module.exports=app;
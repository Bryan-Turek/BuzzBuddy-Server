var passport=require('passport'),LocalStrategy=require('passport-local').Strategy;exports.localStrategy=function(){return new LocalStrategy(function(email,password,done){User.findOne({email:email},function(err,user){if(err){return done(err);}if(!user){return done(null,false,{message:'Login not found'});}if(!user.passwordMatches(password)){return done(null,false,{message:'Incorrect Password'});}done(null,user);});});}exports.isAuthenticated=function(role){return function(req,res,next){if(!req.isAuthenticated()){req.session.goingTo=req.url;res.redirect('/login');return;}if(role&&req.user.role!==role){res.status(401);res.json({error:'401',message:'User does not have permission'});}next();}}exports.injectUser=function(req,res,next){if(req.isAuthenticated()){res.locals.user=req.user;}next();}
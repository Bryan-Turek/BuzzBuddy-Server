'use strict';var mongoose=require('mongoose'),Schema=mongoose.Schema,nconf=require('nconf'),bcrypt=require('bcrypt');var UserModel=function(){var UserSchema=mongoose.Schema({email:{type:String,required:true,unique:true},password:{type:String,required:true,select:false},phone:{type:String,required:true},name:String,role:String,created:Date,verified:Boolean,private:{type:Boolean,select:false},friends:[{type:Schema.Types.ObjectId,ref:'User'}],events:[{type:Schema.Types.ObjectId,ref:'Event'}]});UserSchema.pre('save',function(next){var user=this;if(!user.isModified('password')){next();return;}var DIFFICULTY=(nconf.get('bcrypt')&&nconf.get('bcrypt').difficulty)||8;var hashedPwd=bcrypt.hashSync(user.password,DIFFICULTY);user.password=hashedPwd;next();});UserSchema.methods.passwordMatches=function(plainText){var user=this;return bcrypt.compareSync(plainText,user.password);}return mongoose.model('User',UserSchema);};module.exports=new UserModel();